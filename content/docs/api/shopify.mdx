---
title: "Shopify"
description: "Shopify embedded app integration"
---

# Shopify

Shopify embedded app integration

## Get shop configuration status

<MethodBadge method="GET" path="/shopify/shop/status" />

Check if a Shopify shop has completed OAuth and has a configured project.
Used by the embedded app to determine which UI to show (wizard vs dashboard).

Authentication: Requires Shopify session token via Authorization header.
The shop domain is extracted from the session token's 'dest' claim.

Called from the Shopify embedded app on initial load.


**Authentication required:** shopifySessionToken

### Code Examples

<CodeTabs samples={[
  {
    language: "cURL",
    code: `curl -X GET "https://searchaf.antfly.io/api/v1/shopify/shop/status" \\\\
    -H "Authorization: Bearer YOUR_API_KEY"`
  },
  {
    language: "TypeScript",
    code: `const response = await fetch('https://searchaf.antfly.io/api/v1/shopify/shop/status', {
    method: 'GET',
    headers: {
        'Authorization': 'Bearer YOUR_API_KEY'
    }
});

const data = await response.json();`
  },
  {
    language: "JavaScript",
    code: `fetch('https://searchaf.antfly.io/api/v1/shopify/shop/status', {
    method: 'GET',
    headers: {
        'Authorization': 'Bearer YOUR_API_KEY'
    }
})
    .then(response => response.json())
    .then(data => console.log(data));`
  },
  {
    language: "Python",
    code: `import requests

headers = {
    'Authorization': 'Bearer YOUR_API_KEY'
}

response = requests.get('https://searchaf.antfly.io/api/v1/shopify/shop/status', headers=headers)

data = response.json()`
  },
  {
    language: "Go",
    code: `package main

import (
    "bytes"
    "encoding/json"
    "net/http"
)

func main() {
    req, _ := http.NewRequest("GET", "https://searchaf.antfly.io/api/v1/shopify/shop/status", nil)
    req.Header.Set("Authorization", "Bearer YOUR_API_KEY")

    client := &http.Client{}
    resp, _ := client.Do(req)
    defer resp.Body.Close()
}`
  }
]} />

### Responses

<ResponseTabs responses={[
  {
    statusCode: "200",
    description: "Shop status retrieved successfully",
    body: `{
  "has_oauth": true,
  "has_project": false,
  "shop_domain": "example.myshopify.com",
  "project": {
    "id": "550e8400-e29b-41d4-a716-446655440000",
    "organization_id": "550e8400-e29b-41d4-a716-446655440000",
    "name": "My Store",
    "slug": "my-store",
    "project_type": "woocommerce",
    "antfly_cluster_id": "string",
    "integration_config": {},
    "tables": [
      {
        "id": "550e8400-e29b-41d4-a716-446655440000",
        "project_id": "550e8400-e29b-41d4-a716-446655440000",
        "slug": "products",
        "is_default": true,
        "created_at": "2025-10-02T15:30:00Z",
        "updated_at": "2025-10-02T15:30:00Z"
      }
    ],
    "status": "active",
    "created_at": "2025-10-02T15:30:00Z",
    "updated_at": "2025-10-02T15:30:00Z",
    "settings": {}
  }
}`
  },
  {
    statusCode: "400",
    description: "Bad Request",
  }
]} />


---

## Get widget configuration for shop

<MethodBadge method="GET" path="/shopify/widget-config" />

Returns the configuration needed for the theme extension widget, including
a read-only API key, table slug, and API URL. This endpoint is used by the
embedded app dashboard to sync configuration to app metafields.

Authentication: Requires Shopify session token via Authorization header.
The shop domain is extracted from the session token's 'dest' claim.


**Authentication required:** shopifySessionToken

### Code Examples

<CodeTabs samples={[
  {
    language: "cURL",
    code: `curl -X GET "https://searchaf.antfly.io/api/v1/shopify/widget-config" \\\\
    -H "Authorization: Bearer YOUR_API_KEY"`
  },
  {
    language: "TypeScript",
    code: `const response = await fetch('https://searchaf.antfly.io/api/v1/shopify/widget-config', {
    method: 'GET',
    headers: {
        'Authorization': 'Bearer YOUR_API_KEY'
    }
});

const data = await response.json();`
  },
  {
    language: "JavaScript",
    code: `fetch('https://searchaf.antfly.io/api/v1/shopify/widget-config', {
    method: 'GET',
    headers: {
        'Authorization': 'Bearer YOUR_API_KEY'
    }
})
    .then(response => response.json())
    .then(data => console.log(data));`
  },
  {
    language: "Python",
    code: `import requests

headers = {
    'Authorization': 'Bearer YOUR_API_KEY'
}

response = requests.get('https://searchaf.antfly.io/api/v1/shopify/widget-config', headers=headers)

data = response.json()`
  },
  {
    language: "Go",
    code: `package main

import (
    "bytes"
    "encoding/json"
    "net/http"
)

func main() {
    req, _ := http.NewRequest("GET", "https://searchaf.antfly.io/api/v1/shopify/widget-config", nil)
    req.Header.Set("Authorization", "Bearer YOUR_API_KEY")

    client := &http.Client{}
    resp, _ := client.Do(req)
    defer resp.Body.Close()
}`
  }
]} />

### Responses

<ResponseTabs responses={[
  {
    statusCode: "200",
    description: "Widget configuration retrieved successfully",
    body: `{
  "api_key": "searchaf_ro_abc123...",
  "table_slug": "products",
  "api_url": "https://searchaf.antfly.io/api/v1"
}`
  },
  {
    statusCode: "400",
    description: "Bad Request",
  },
  {
    statusCode: "401",
    description: "Unauthorized",
  },
  {
    statusCode: "404",
    description: "Shop or project not found, or no read-only API key available",
    body: `{
  "type": "https://searchaf.antfly.io/errors/validation-error",
  "title": "Validation Error",
  "status": 400,
  "detail": "Email address is required",
  "instance": "https://searchaf.antfly.io/api/v1/users/550e8400-e29b-41d4-a716-446655440000",
  "errors": [
    {
      "field": "string",
      "message": "string"
    }
  ]
}`
  }
]} />


---

## Create a Shopify project

<MethodBadge method="POST" path="/shopify/projects" />

Creates a new project linked to a Shopify shop. This endpoint:
1. Looks up shop details from the user's pending OAuth token (user_shop_tokens)
2. Creates a new project with type "shopify"
3. Links the shop to the project by creating shopify_shops record
4. Moves the access token from user_shop_tokens to shopify_access_tokens

Requires the user to have completed OAuth with the Shopify shop first.
Called from the SearchAF dashboard after OAuth completion.


**Authentication required:** bearerAuth

### Request Body

**Content-Type:** `application/json`

### Code Examples

<CodeTabs samples={[
  {
    language: "cURL",
    code: `curl -X POST "https://searchaf.antfly.io/api/v1/shopify/projects" \\\\
    -H "Authorization: Bearer YOUR_API_KEY"`
  },
  {
    language: "TypeScript",
    code: `const response = await fetch('https://searchaf.antfly.io/api/v1/shopify/projects', {
    method: 'POST',
    headers: {
        'Authorization': 'Bearer YOUR_API_KEY'
    }
});

const data = await response.json();`
  },
  {
    language: "JavaScript",
    code: `fetch('https://searchaf.antfly.io/api/v1/shopify/projects', {
    method: 'POST',
    headers: {
        'Authorization': 'Bearer YOUR_API_KEY'
    }
})
    .then(response => response.json())
    .then(data => console.log(data));`
  },
  {
    language: "Python",
    code: `import requests

headers = {
    'Authorization': 'Bearer YOUR_API_KEY'
}

response = requests.post('https://searchaf.antfly.io/api/v1/shopify/projects', headers=headers)

data = response.json()`
  },
  {
    language: "Go",
    code: `package main

import (
    "bytes"
    "encoding/json"
    "net/http"
)

func main() {
    req, _ := http.NewRequest("POST", "https://searchaf.antfly.io/api/v1/shopify/projects", nil)
    req.Header.Set("Authorization", "Bearer YOUR_API_KEY")

    client := &http.Client{}
    resp, _ := client.Do(req)
    defer resp.Body.Close()
}`
  }
]} />

### Responses

<ResponseTabs responses={[
  {
    statusCode: "201",
    description: "Shopify project created successfully",
    body: `{
  "id": "550e8400-e29b-41d4-a716-446655440000",
  "organization_id": "550e8400-e29b-41d4-a716-446655440000",
  "name": "My Store",
  "slug": "my-store",
  "project_type": "woocommerce",
  "antfly_cluster_id": "string",
  "integration_config": {},
  "tables": [
    {
      "id": "550e8400-e29b-41d4-a716-446655440000",
      "project_id": "550e8400-e29b-41d4-a716-446655440000",
      "slug": "products",
      "is_default": true,
      "created_at": "2025-10-02T15:30:00Z",
      "updated_at": "2025-10-02T15:30:00Z"
    }
  ],
  "status": "active",
  "created_at": "2025-10-02T15:30:00Z",
  "updated_at": "2025-10-02T15:30:00Z",
  "settings": {}
}`
  },
  {
    statusCode: "400",
    description: "Bad Request",
  },
  {
    statusCode: "401",
    description: "Unauthorized",
  },
  {
    statusCode: "404",
    description: "Shop OAuth token not found",
    body: `{
  "type": "https://searchaf.antfly.io/errors/validation-error",
  "title": "Validation Error",
  "status": 400,
  "detail": "Email address is required",
  "instance": "https://searchaf.antfly.io/api/v1/users/550e8400-e29b-41d4-a716-446655440000",
  "errors": [
    {
      "field": "string",
      "message": "string"
    }
  ]
}`
  },
  {
    statusCode: "409",
    description: "Shop is already linked to a project",
    body: `{
  "type": "https://searchaf.antfly.io/errors/validation-error",
  "title": "Validation Error",
  "status": 400,
  "detail": "Email address is required",
  "instance": "https://searchaf.antfly.io/api/v1/users/550e8400-e29b-41d4-a716-446655440000",
  "errors": [
    {
      "field": "string",
      "message": "string"
    }
  ]
}`
  }
]} />


---

## Get sync job status

<MethodBadge method="GET" path="/shopify/sync/{id}" />

Poll sync job status to track product sync progress.
Returns current status, progress percentage, and any error messages.

Use this endpoint to poll for sync completion (typically every 2 seconds).
Stop polling when status is 'completed' or 'failed'.

Called from the Shopify embedded app dashboard.


**Authentication required:** shopifySessionToken

### Parameters

| Name | Type | Location | Required | Description |
|------|------|----------|----------|-------------|
| `id` | string | path | Yes | Sync job ID |

### Code Examples

<CodeTabs samples={[
  {
    language: "cURL",
    code: `curl -X GET "https://searchaf.antfly.io/api/v1/shopify/sync/123e4567-e89b-12d3-a456-426614174000" \\\\
    -H "Authorization: Bearer YOUR_API_KEY"`
  },
  {
    language: "TypeScript",
    code: `const response = await fetch('https://searchaf.antfly.io/api/v1/shopify/sync/123e4567-e89b-12d3-a456-426614174000', {
    method: 'GET',
    headers: {
        'Authorization': 'Bearer YOUR_API_KEY'
    }
});

const data = await response.json();`
  },
  {
    language: "JavaScript",
    code: `fetch('https://searchaf.antfly.io/api/v1/shopify/sync/123e4567-e89b-12d3-a456-426614174000', {
    method: 'GET',
    headers: {
        'Authorization': 'Bearer YOUR_API_KEY'
    }
})
    .then(response => response.json())
    .then(data => console.log(data));`
  },
  {
    language: "Python",
    code: `import requests

headers = {
    'Authorization': 'Bearer YOUR_API_KEY'
}

response = requests.get('https://searchaf.antfly.io/api/v1/shopify/sync/123e4567-e89b-12d3-a456-426614174000', headers=headers)

data = response.json()`
  },
  {
    language: "Go",
    code: `package main

import (
    "bytes"
    "encoding/json"
    "net/http"
)

func main() {
    req, _ := http.NewRequest("GET", "https://searchaf.antfly.io/api/v1/shopify/sync/123e4567-e89b-12d3-a456-426614174000", nil)
    req.Header.Set("Authorization", "Bearer YOUR_API_KEY")

    client := &http.Client{}
    resp, _ := client.Do(req)
    defer resp.Body.Close()
}`
  }
]} />

### Responses

<ResponseTabs responses={[
  {
    statusCode: "200",
    description: "Sync job status retrieved successfully",
    body: `{
  "id": "550e8400-e29b-41d4-a716-446655440000",
  "shopify_shop_id": "550e8400-e29b-41d4-a716-446655440000",
  "status": "pending",
  "progress_percent": 45,
  "last_cursor": "string",
  "error_message": "string",
  "started_at": "2025-10-02T15:30:00Z",
  "completed_at": "2025-10-02T15:30:00Z",
  "created_at": "2025-10-02T15:30:00Z",
  "updated_at": "2025-10-02T15:30:00Z"
}`
  },
  {
    statusCode: "404",
    description: "Sync job not found",
    body: `{
  "type": "https://searchaf.antfly.io/errors/validation-error",
  "title": "Validation Error",
  "status": 400,
  "detail": "Email address is required",
  "instance": "https://searchaf.antfly.io/api/v1/users/550e8400-e29b-41d4-a716-446655440000",
  "errors": [
    {
      "field": "string",
      "message": "string"
    }
  ]
}`
  }
]} />


---

## Shopify webhook

<MethodBadge method="POST" path="/webhooks/shopify" />

Handle Shopify webhook events (app/uninstalled, shop/update, etc).
This endpoint:
1. Verifies the HMAC signature from Shopify
2. Routes to the appropriate handler based on X-Shopify-Topic header

For app/uninstalled events:
- Freezes the associated project (sets status to 'frozen')
- Deletes access tokens for the shop
- Updates shop records with uninstall timestamp

This webhook is automatically called by Shopify based on the configured topics.


### Parameters

| Name | Type | Location | Required | Description |
|------|------|----------|----------|-------------|
| `X-Shopify-Hmac-Sha256` | string | header | Yes | HMAC signature for webhook verification |
| `X-Shopify-Shop-Domain` | string | header | No | Shop domain (optional, included in payload) |
| `X-Shopify-Topic` | string | header | Yes | Webhook topic (e.g., app/uninstalled, shop/update) |

### Request Body

**Content-Type:** `application/json`

### Code Examples

<CodeTabs samples={[
  {
    language: "cURL",
    code: `curl -X POST "https://searchaf.antfly.io/api/v1/webhooks/shopify" \\\\
    -H "Authorization: Bearer YOUR_API_KEY"`
  },
  {
    language: "TypeScript",
    code: `const response = await fetch('https://searchaf.antfly.io/api/v1/webhooks/shopify', {
    method: 'POST',
    headers: {
        'Authorization': 'Bearer YOUR_API_KEY'
    }
});

const data = await response.json();`
  },
  {
    language: "JavaScript",
    code: `fetch('https://searchaf.antfly.io/api/v1/webhooks/shopify', {
    method: 'POST',
    headers: {
        'Authorization': 'Bearer YOUR_API_KEY'
    }
})
    .then(response => response.json())
    .then(data => console.log(data));`
  },
  {
    language: "Python",
    code: `import requests

headers = {
    'Authorization': 'Bearer YOUR_API_KEY'
}

response = requests.post('https://searchaf.antfly.io/api/v1/webhooks/shopify', headers=headers)

data = response.json()`
  },
  {
    language: "Go",
    code: `package main

import (
    "bytes"
    "encoding/json"
    "net/http"
)

func main() {
    req, _ := http.NewRequest("POST", "https://searchaf.antfly.io/api/v1/webhooks/shopify", nil)
    req.Header.Set("Authorization", "Bearer YOUR_API_KEY")

    client := &http.Client{}
    resp, _ := client.Do(req)
    defer resp.Body.Close()
}`
  }
]} />

### Responses

<ResponseTabs responses={[
  {
    statusCode: "200",
    description: "Webhook processed successfully",
    body: `{
  "received": true
}`
  },
  {
    statusCode: "400",
    description: "Invalid payload",
  },
  {
    statusCode: "401",
    description: "Invalid HMAC signature",
  }
]} />


